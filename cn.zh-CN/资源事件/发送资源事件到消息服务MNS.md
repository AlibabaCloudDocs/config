# 发送资源事件到消息服务MNS

您可以在配置审计中设置将资源变更事件、资源不合规事件和资源快照投递事件发送到消息服务MNS的指定主题，您还可以根据所需设置该主题的推送方式和内容。

请确保您已开通消息服务MNS。具体操作，请参见[开通消息服务MNS并授权]()。

## 普通账号

阿里云账号可以设置将自己的资源事件发送到消息服务MNS的指定主题中。

1.  登录[配置审计控制台](https://config.console.aliyun.com)。

2.  在左侧导航栏，选择**投递服务** \> **订阅资源事件**。

3.  在订阅资源事件页面，打开**设置消息服务MNS**开关。

4.  设置用于接收资源事件的主题。

    主题的相关参数如下表所示。

    |参数|描述|
    |--|--|
    |**主题地域**|主题名称所在地域。|
    |**主题名称**|消息服务MNS中的主题名称。同一账号同一地域下，主题名称不能重复。    -   当您选中**本账号中新建主题**时，通过配置审计控制台新建主题，输入主题名称。
    -   当您选中**选择本账号中已有的主题**时，在消息服务MNS中选择已有主题。 |
    |**消息最大长度（Byte）**|发送到该主题的消息体的最大长度。取值范围：1024~65536。默认值：65536。 **说明：** 由于资源信息较大，请您在消息服务MNS控制台上将主题信息的最大长度至少设置为8192，以免因长度限制导致消息发送失败。 |
    |**开启Logging**|是否将主题接收消息、转发消息和删除消息的日志存储到主题默认关联的日志服务SLS。|
    |**订阅事件的最低风险等级**|当您配置事件订阅时，您需配置接收的最低风险等级。取值：     -   **全部风险等级**
    -   **高风险**
    -   **中风险**
    -   **低风险**
例如：如果您选择**中风险**，则配置审计为您推送**中风险**和**高风险**等级的不合规事件，**低风险**级别的不合规事件将被过滤掉。 |
    |**订阅指定资源类型事件**|订阅指定资源类型的事件。取值：    -   **服务支持的全部资源类型**：订阅全部资源类型事件。当配置审计对接新产品后，该产品的资源类型将自动纳入监控范围。
    -   **自定义资源类型**：自定义选择资源类型事件。 |

5.  单击**确定**。


## 企业管理账号

企业管理账号可以设置将自己和资源目录中所有成员账号的资源事件发送到消息服务MNS的指定主题中。成员账号无权设置发送资源事件到消息服务MNS，只能按照企业管理账号的设置进行发送。

1.  登录[配置审计控制台](https://config.console.aliyun.com)。

2.  在左侧导航栏，选择**投递服务** \> **订阅资源事件**。

3.  在订阅资源事件页面，打开**设置消息服务MNS**开关。

4.  设置用于接收资源事件的主题。

    您可以在当前企业管理账号中新建主题，也可以选择当前企业管理账号或其他成员账号中已有主题。该主题用于接收企业管理账号和所有成员账号的资源事件。

    -   当您需要将企业管理账号和所有成员账号的资源事件统一发送到当前企业管理账号的指定主题时，需要选择**本账号中新建主题**或**选择本账号中已有的主题**。主题的相关参数如下表所示。

        |参数|描述|
        |--|--|
        |**主题地域**|主题名称所在地域。|
        |**主题名称**|消息服务MNS中的主题名称。同一账号同一地域下，主题名称不能重复。        -   当您选中**本账号中新建主题**时，通过企业版配置审计控制台新建主题，输入主题名称。
        -   当您选中**选择本账号中已有的主题**时，在消息服务MNS中选择已有主题。 |
        |**消息最大长度（Byte）**|发送到该主题的消息体的最大长度。取值范围：1024~65536。默认值：65536。 **说明：** 由于资源信息较大，请您在消息服务MNS控制台上将主题信息的最大长度至少设置为8192，以免因长度限制导致消息发送失败。 |
        |**开启Logging**|是否将主题接收消息、转发消息和删除消息的日志存储到主题默认关联的日志服务SLS。|
        |**订阅事件的最低风险等级**|如果您设置了合规规则，则会接收到资源不合规事件。您可以通过设置**订阅事件的最低风险等级**来过滤需要接收的资源不合规事件，取值：         -   **全部风险等级**
        -   **高风险**
        -   **中风险**
        -   **低风险**
例如：如果您选择**中风险**，则配置审计为您推送**中风险**和**高风险**等级的不合规事件，**低风险**级别的不合规事件将被过滤掉。 |
        |**订阅指定资源类型事件**|订阅指定资源类型的事件。取值：        -   **服务支持的全部资源类型**：订阅全部资源类型事件。当配置审计对接新产品后，该产品的资源类型将自动纳入监控范围。
        -   **自定义资源类型**：勾选需监控的资源类型，自定义选择资源类型事件。 |

    -   当您需要将企业管理账号和所有成员账号的资源事件统一发送到指定成员账号的指定主题时，需要选择**选择其他账号已有的主题（仅支持企业管理账号）**。设置主题相关参数之前，请您确保该成员账号中已有可用主题。目标成员账号中主题ARN和扮演角色ARN的相关参数如下表所示。

        |参数|描述|
        |--|--|
        |**目标账号中主题的ARN**|目标成员账号中主题的ARN，例如：`acs:mns:cn-shanghai:178589740730****:/topics/topic1`。ARN格式为`acs:mns:{regionId}:{AccountID}:/topics/{topicName}`，各参数含义如下：

        -   `{regionId}`：主题所在地域ID，例如：cn-shanghai。关于如何查看主题所在地域，请参见[查看主题]()。
        -   `{AccountID}`：目标成员账号ID，例如：178589740730\*\*\*\*。关于如何查看成员账号ID，请参见[查看成员详情]()。
        -   `{topicName}`：主题名称，例如：topic1。关于如何查看主题，请参见[查看主题]()。 |
        |**目标账号中需扮演角色的ARN**|目标成员账号需要扮演角色的ARN，例如：`acs:ram::178589740730****:role/aliyunserviceroleforconfig`。ARN格式为`acs:ram::{AccountID}:role/aliyunserviceroleforconfig`，各参数含义如下：

        -   `{AccountID}`：目标成员账号ID，例如：178589740730\*\*\*\*。关于如何查看成员账号ID，请参见[查看成员详情]()。
        -   `aliyunserviceroleforconfig`：配置审计服务关联角色。 |

5.  单击**确定**。


资源事件发送到指定主题后，您可以在消息服务MNS控制台的目标主题中设置该主题的推送方式和内容。具体操作，请参见[发布消息]()。

